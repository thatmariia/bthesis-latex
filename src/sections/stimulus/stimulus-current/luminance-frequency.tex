\subsubsection{Luminance and frequency}

\todo{update variable names}

To transform the stimulus patch $L$ to the patch of PING networks in V1, we apply the lattice of size $n \times n$, such that each oscillatory network contains a field of $m \times m$ pixels. An example of the resulting lattice is displayed in Figure \ref{fig:llc-lattice-example}.



\begin{figure}[!htp]
    \centering
    \begin{subfigure}[t]{0.4\textwidth}
        \centering
        \input{src/assets/tikz-images/stimulus-patch-lattice}
        \caption{A $12 \times 12$ lattice applied to a patch.}
        \label{fig:llc-lattice-example}
    \end{subfigure}
    \hspace{0.06\textwidth}
    \begin{subfigure}[t]{0.4\textwidth}
        \centering
        \includegraphics[width=\textwidth]{src/assets/images/local-contrast.png}
        \caption{Local contrasts of the patch in Figure \ref{fig:llc-lattice-example}.}
        \label{fig:llc-local-contrast-example}
    \end{subfigure}
    \caption{The lattice of a patch and its vertices' local contrasts. The parameters with which the patch was generated: $\diam = 53, \anndistscale = 1.6, \contrange = 1, \figeccdg = 11^\circ, \patchsizedg = 3^\circ$; the rest of the parameters are equal to the ones used in Figure \ref{fig:full-stimulus-example}.}
    \label{fig:lattice-local-contrast-example}
\end{figure}




Let $V_\ping$ be the set containing the PING networks. Let $\pix: V_\ping \to (\mathbb{N}_0)^{2 \times m^2}$ be a function mapping a network to the set of all $m^2$ pixel coordinates it contains.
For each network $v \in V_\ping$, a local contrast $\LC: V \to \mathbb{R}$ is the weighted root-mean-squared (RMS) contrast defined as follows \cite{Frazor2006}:
\begin{equation}
    \LC_v = \sqrt{
        \frac{
            \sum_{(i, j) \in \pix(v)} \weight_{v, (i, j)} \frac{(L_{i, j} - \overline{L})^2}{\overline{L}}
        }{
            \sum_{(i, j) \in \pix(v)} \weight_{v, (i, j)}
        }
    },
\end{equation}
where $\overline{L}$ is the mean over all luminance values in $L$, and $\weight: V_\ping, \mathbb{N}^2 \to \mathbb{R}$ is the weight of a pixel with respect to a network, as shown in Equation (\ref{eq:weight-pixel-network}). 

To define that weight, one first needs to complete a number of steps.
Let $\centr : V_\ping \to \mathbb{R}_+^2$ be the function mapping a particular PING network to the \todo{are we talking about physical or pixel location here?} location of its center within the stimulus. As the center of the gaze (fovea) coincides with the center of the stimulus, the eccentricity $\ecc: V_\ping \to \mathbb{R}_+$ for a network $v \in V_\ping$ is
\begin{equation}
    \ecc_{v} = \left\| \left( \frac{\ell_\full}{2}, \frac{\ell_\full}{2} \right), \centr(v) \right\|.
\end{equation}

Let $\slope \in \mathbb{R}$ be the slope of the size of the receptive field and $\intercept \in \mathbb{R}$ - its intercept. \todo{what are those exactly?}
Let $\diamRF_{\min} > 0$ be smallest allowed diameter of the receptive field. \todo{where do we get it from? reference?}
Then, the diameter of the receptive field $\diamRF \in \mathbb{R}$ of $v$ is 
\begin{equation}
    \diamRF_v = \max{( \slope \cdot \ecc_v + \intercept, \ \diamRF_{\min} )}.
\end{equation}
\todo{The ref was \cite{Freeman2011} but I didn't find it there, including vals for slope and intercept (0.172, -0.25)}
Let $\sigma: V_\ping \to \mathbb{R}$ be the standard deviation of the receptive field diameter of a Gaussian beam \todo{why do we consider it a Gaussian beam?}. It can be obtained by utilizing the full width at half maximum $\fwhm: V_\ping \to \mathbb{R}$ in the following way \cite{MaryamPLACEHOLDER}:
\begin{equation}
    \begin{cases}
        \fwhm_v = \sqrt{\frac{\ln(2)}{2}} \cdot \diamRF_v \\
        \fwhm_v = 2 \sqrt{2 \ln(2)} \cdot \sigma_v
    \end{cases}
    \Rightarrow 
    \sigma_v = \frac{1}{4} \diamRF_v.
\end{equation}
Having derived the standard deviation, the weight of the pixel $i, j \in \{ 0, 1, \cdots, M-1 \}$ with respect to a PING network $v$ can be defined at last. This value is specific to each network as it reflects its unique receptive field modeled with an isotropic 2D Gaussian function \cite{MaryamPLACEHOLDER}:
\begin{equation}
    \weight_{v, (i, j)} = \exp \left(
        -\frac{\| (i, j), \ \centr(v) \|}{ 2 \sigma_v^2 }
    \right).
    \label{eq:weight-pixel-network}
\end{equation}

Now, the oscillation \todo{oscillation of what exactly?} frequency $f$ and angular frequency $\omega$ of the network $v$ can be obtained through the local contrast:
\begin{gather}
    f_v = 25 + 0.25 \cdot \LC_v, \\
    \omega_v = 2 \pi f_v.
\end{gather}
These relations reflect the typical gamma frequency of a neural network in V1.
\\ \todo{Reference? Where is this relation coming from?}


